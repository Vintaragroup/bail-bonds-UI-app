# Session Progress Log — 2025-10-08

This log tracks today's incremental work and maps it to the active todo list.

## 1) Mobile auth failures on iOS Safari (401) — RESOLVED

Actions
- Investigated iOS-only 401s despite desktop success; reproduced on device and inspected via Safari Web Inspector.
- Implemented client-wide bearer auth fallback:
  - `src/lib/api.js`: export `getAuthHeader()` and add Authorization: Bearer <Firebase ID token> on requests while keeping `credentials: 'include'`.
  - `src/components/UserContext.tsx`: attach bearer on `/auth/me`.
  - Updated all remaining fetches (`src/hooks/dashboard.js`, `src/hooks/polling.js`, `src/components/DashboardDebugPanel.jsx`, probe runner) to include bearer header.
- Verified the server already accepts bearer tokens (middleware `requireAuth`/`optionalAuth`).
- Pushed to `deploy/production` and validated on iPhone: UI loads and API calls succeed (no 401s).

Results
- ✅ Mobile (iOS Safari) authenticates and loads data without errors.

Follow-ups
- Ensure Firebase Auth Authorized Domains include production web origins to avoid provider warnings.

## 2) Edge debugging noise — SILENCED

Actions
- Removed Edge launch profile from `.vscode/launch.json` to eliminate Edge-related errors.

Results
- ✅ Chrome + Safari workflows remain; no Edge warnings in VS Code.

## 3) Error overlay gating — DONE

Actions
- Gated the tiny red error banner behind `DEV_ERROR_OVERLAY` (default off):
  - `index.html` checks `window.__ENV__.DEV_ERROR_OVERLAY==='true'` or `?dev_error_overlay=1` before activating.
  - `public/env.js` and `public/env.example.js` include `DEV_ERROR_OVERLAY: 'false'`.
  - `README.md` documents how to enable temporarily.

Results
- ✅ Overlay disabled by default; easy to enable for targeted debugging without exposing PII.

## Planned next tasks
- Enable HTTPS in Vite dev (mkcert/self-signed) with proxy intact.
- Polish mobile auth UX (spinner during redirect handling; clearer errors).
- Mobile UI polish: bottom nav with safe-area; tap targets/typography; keyboard-aware forms.
- Performance: code-split heavy routes.
- Testing/Docs: Playwright mobile smoke; mobile LAN dev guide; dev scripts incl. `/api/health/light` reference.

## Acceptance criteria mapping
- Fix production mobile auth — Done (on-device verified).
- Gate error overlay — Done (off by default, doc updated).
- Remaining items — Not started; ready to pick up next.
